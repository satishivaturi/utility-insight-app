<script>
  const fileInput = document.getElementById('fileInput');
  const billSummary = document.getElementById('billSummary');

  fileInput.addEventListener('change', (event) => {
    const file = event.target.files[0];

    if (!file) {
      billSummary.innerHTML = '<p>No file selected.</p>';
      return;
    }

    const reader = new FileReader();

    reader.onload = function(e) {
      const xmlText = e.target.result;
      const parser = new DOMParser();
      const xmlDoc = parser.parseFromString(xmlText, "application/xml");

      const readings = xmlDoc.getElementsByTagName("IntervalReading");

      let monthlyData = {}; // Store usage by year-month
      let firstTimestamp = null;

      for (let reading of readings) {
        const start = parseInt(reading.getElementsByTagName("start")[0].textContent);
        const value = parseInt(reading.getElementsByTagName("value")[0].textContent);

        if (!firstTimestamp || start < firstTimestamp) {
          firstTimestamp = start;
        }

        const date = new Date(start * 1000);
        const yearMonth = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}`;

        if (!monthlyData[yearMonth]) {
          monthlyData[yearMonth] = 0;
        }
        monthlyData[yearMonth] += value / 10000; // Convert to m³
      }

      // Generate bill summary table
      let billSummaryHtml = '<h2>Bill Summary:</h2>';
      billSummaryHtml += `<p><strong>Billing Start Date:</strong> ${firstTimestamp ? new Date(firstTimestamp * 1000).toDateString() : 'Unknown'}</p>`;
      billSummaryHtml += '<table border="1"><tr><th>Billing Month</th><th>Gas Used (m³)</th><th>Estimated Bill ($)</th></tr>';

      for (const [month, usage] of Object.entries(monthlyData)) {
        const bill = usage * 0.25; // Estimate $0.25 per m³
        billSummaryHtml += `<tr><td>${month}</td><td>${usage.toFixed(2)}</td><td>$${bill.toFixed(2)}</td></tr>`;
      }

      billSummaryHtml += '</table>';
      billSummary.innerHTML = billSummaryHtml;
    };

    reader.readAsText(file);
  });
</script>
